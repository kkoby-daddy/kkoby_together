<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Together ë†€ì´í„°</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>
<!-- í°íŠ¸: Noto Sans KR + Tech ëŠë‚Œì˜ Orbit -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Orbit&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-gradient: linear-gradient(135deg, #0f1115 0%, #1a1d26 100%);
    --sidebar-bg: rgba(22, 26, 34, 0.95);
    --main-bg: rgba(15, 17, 21, 0.6);
    --card-bg: rgba(35, 42, 54, 0.7);
    --border: 1px solid rgba(255, 255, 255, 0.1);
    --accent: #6aa0ff;
    --accent-glow: rgba(106, 160, 255, 0.3);
    --text-main: #e8ecf3;
    --text-sub: #8a9099;
    --ok: #35c759; --warn: #ffb300; --bad: #ff5171;
    --font-main: 'Noto Sans KR', sans-serif;
    --font-tech: 'Orbit', sans-serif;
    --radius: 16px;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    margin: 0; padding: 0;
    font-family: var(--font-main);
    background: var(--bg-gradient);
    color: var(--text-main);
    height: 100vh;
    overflow: hidden; 
  }

  /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
  .floating-tip {
    position: fixed; z-index: 9999; max-width: 300px;
    background: #0b1320; color: #cfe1ff; border: 1px solid #2b3a55;
    border-radius: 10px; padding: 8px 12px; font-size: 12px; line-height: 1.4;
    box-shadow: 0 8px 24px rgba(0,0,0,0.5);
    pointer-events: none; white-space: normal; word-break: keep-all;
    opacity: 0; transform: translateY(5px);
    transition: opacity .15s ease, transform .15s ease;
  }
  .floating-tip.show { opacity: 1; transform: translateY(0); }

  /* ë ˆì´ì•„ì›ƒ */
  .app-container { display: flex; height: 100%; width: 100vw; }

  /* ì‚¬ì´ë“œë°” */
  .sidebar {
    width: 400px;
    background: var(--sidebar-bg);
    backdrop-filter: blur(12px);
    border-right: var(--border);
    display: flex; flex-direction: column;
    z-index: 100;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .sidebar-header { padding: 20px; border-bottom: var(--border); flex-shrink: 0; }
  .brand-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
  .brand { font-family: var(--font-tech); font-size: 18px; font-weight: 700; color: var(--accent); letter-spacing: 1px; }
  .ver { font-size: 11px; color: var(--text-sub); display: flex; justify-content: space-between; margin-top: 4px; }
  
  .search-area { padding: 15px 20px 5px; flex-shrink: 0; }
  .search-box { position: relative; margin-bottom: 10px; }
  .search-box input {
    width: 100%; background: rgba(0,0,0,0.3); border: var(--border);
    border-radius: 8px; padding: 12px; color: var(--text-main);
    outline: none; font-size: 16px;
  }
  .search-box input:focus { border-color: var(--accent); }

  .filter-chips { display: flex; flex-wrap: wrap; gap: 6px; padding: 0 20px 15px; flex-shrink: 0; }
  #chosungTokens { padding: 0 20px 10px; min-height: 38px; align-items: center; }
  
  .chip {
    font-size: 12px; padding: 6px 10px; background: rgba(255,255,255,0.05);
    border-radius: 6px; cursor: pointer; color: var(--text-sub);
    transition: 0.2s; border: 1px solid transparent; user-select: none;
  }
  .chip:hover { background: rgba(255,255,255,0.1); }
  .chip.active { background: var(--accent-glow); color: var(--accent); border-color: var(--accent); font-weight: 700; }
  .chip.label { background: transparent; color: var(--text-sub); border-color: transparent; cursor: default; font-weight: bold; padding-left: 0; }

  .pet-list { flex: 1; overflow-y: auto; padding: 0 10px 20px 20px; -webkit-overflow-scrolling: touch; }
  .pet-list::-webkit-scrollbar { width: 6px; }
  .pet-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }

  .pet-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 14px 16px; margin-bottom: 8px;
    background: rgba(255,255,255,0.03); border-radius: 10px;
    cursor: pointer; border: 1px solid transparent; transition: all 0.2s;
  }
  .pet-item:active { background: rgba(255,255,255,0.07); transform: scale(0.98); }
  .pet-item.selected { background: var(--accent-glow); border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
  .pet-name { font-weight: 500; font-size: 15px; }
  .pet-right { display: flex; align-items: center; gap: 8px; }
  .badge-r8 { font-size: 10px; padding: 3px 6px; background: rgba(192, 132, 252, 0.15); color: #e879f9; border: 1px solid #c084fc; border-radius: 4px; font-weight: 700; cursor: help; }
  .fav-icon { color: var(--text-sub); font-size: 18px; padding: 4px; }
  .fav-icon.active { color: #ffd700; text-shadow: 0 0 8px rgba(255, 215, 0, 0.5); }

  /* ë©”ì¸ ì»¨í…ì¸  */
  .main-content {
    flex: 1; display: flex; flex-direction: column;
    background: var(--main-bg); overflow-y: auto; position: relative;
    -webkit-overflow-scrolling: touch;
  }
  
  .top-nav {
    display: flex; justify-content: flex-end; align-items: center;
    padding: 15px 20px; z-index: 20; min-height: 60px;
    position: absolute; top: 0; right: 0; left: 0;
    pointer-events: none;
  }
  
  .nav-controls {
    pointer-events: auto;
    display: flex; align-items: center; gap: 12px;
    background: rgba(15, 17, 21, 0.8);
    backdrop-filter: blur(5px);
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.1);
  }

  .menu-toggle { 
    display: none;
    font-size: 24px; color: var(--text-main); cursor: pointer; 
  }
  
  .admin-btn {
    font-size: 18px; color: var(--text-sub); cursor: pointer;
    background: transparent; border: none; padding: 4px;
    transition: 0.2s;
  }
  .admin-btn:hover { color: var(--accent); transform: scale(1.1); text-shadow: 0 0 8px var(--accent); }

  .dashboard {
    padding: 70px 30px 40px;
    max-width: 1400px; margin: 0 auto;
    width: 100%; display: grid; grid-template-columns: 3fr 2fr; gap: 24px;
    align-items: stretch;
  }

  .panel {
    background: var(--card-bg); border-radius: var(--radius);
    border: var(--border); padding: 24px; backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0,0,0,0.2); display: flex; flex-direction: column; height: auto;
    min-height: 520px;
  }
  .panel h2 {
    margin: 0 0 20px; font-size: 18px; font-family: var(--font-tech);
    color: var(--accent); display: flex; align-items: center; gap: 8px;
  }
  .panel h2::before { content:''; display:block; width: 4px; height: 18px; background: var(--accent); border-radius: 2px; }

  .notice-panel { grid-column: 1 / -1; padding: 20px 24px; min-height: auto; }
  .notice-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
  .notice-title { font-size: 18px; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
  .notice-title::before { content: 'â“˜'; color: var(--accent); font-size: 20px; }
  .notice-content { padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 16px; line-height: 1.8; color: var(--text-sub); }

  /* ë¡œê·¸ ì•Œë¦¬ë¯¸ íŒ¨ë„ */
  .log-panel { grid-column: 1 / -1; min-height: auto; margin-top: 10px; }
  .log-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
  
  .log-container {
    background: rgba(0,0,0,0.4); border-radius: 12px; padding: 15px;
    height: 180px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.05);
    font-family: 'Courier New', Courier, monospace; font-size: 14px;
  }
  .log-entry { display: flex; gap: 10px; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.03); animation: fadeIn 0.3s ease; }
  .log-time { color: var(--text-sub); flex-shrink: 0; }
  .log-msg { word-break: break-all; color: var(--text-main); }
  .log-msg.highlight { color: var(--bad); font-weight: 700; text-shadow: 0 0 8px rgba(255,81,113,0.3); }
  .log-msg.capture { color: var(--warn); font-weight: 700; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  .btn-dir-picker {
    padding: 10px 18px; background: rgba(106, 160, 255, 0.1);
    border: 1px dashed var(--accent); color: var(--accent); border-radius: 8px;
    cursor: pointer; font-size: 14px; transition: 0.2s; display: flex; align-items: center; gap: 8px;
  }
  .btn-dir-picker:hover { background: rgba(106, 160, 255, 0.2); }
  
  .log-controls { display: flex; align-items: center; gap: 15px; }
  .status-indicator { font-size: 12px; color: var(--text-sub); display: flex; align-items: center; gap: 6px; }
  .dot { width: 8px; height: 8px; border-radius: 50%; background: #555; }
  .dot.active { background: var(--ok); box-shadow: 0 0 8px var(--ok); }

  /* ì…ë ¥ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
  .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 24px; }
  .stat-col label { display: block; font-size: 12px; color: var(--text-sub); margin-bottom: 6px; text-align: center; }
  .stat-box { background: rgba(0,0,0,0.2); border: var(--border); border-radius: 8px; padding: 8px; text-align: center; display: flex; align-items: center; justify-content: center; }
  .stat-box input { 
    width: 100%; background: transparent; border: none; 
    color: var(--text-main); font-size: 16px; font-weight: 700; 
    text-align: center; outline: none; font-family: var(--font-tech); padding: 0; 
    display: block; margin: 0 auto;
  }
  .stat-box input::-webkit-outer-spin-button, .stat-box input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .stat-box input[type=number] { -moz-appearance: textfield; }
  .stat-box.readonly { opacity: 0.6; background: rgba(0,0,0,0.4); }
  
  .input-group-title { font-size: 13px; color: var(--text-sub); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
  .input-group-title::after { content:''; height:1px; flex:1; background: rgba(255,255,255,0.1); }
  .stepper-btn { width: 100%; display: flex; gap: 4px; margin-top: 6px; }
  .s-btn { flex: 1; background: rgba(255,255,255,0.08); border: none; color: var(--text-sub); font-size: 14px; cursor: pointer; border-radius: 6px; padding: 12px 0; touch-action: manipulation; }
  .s-btn:active { background: rgba(255,255,255,0.2); color: var(--text-main); }

  .action-btns { display: flex; gap: 12px; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.05); }
  .btn-main { flex: 1; padding: 16px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; font-size: 16px; transition: 0.2s; }
  .btn-calc { background: var(--accent); color: #000; }
  .btn-reset { background: rgba(255,255,255,0.1); color: var(--text-main); }

  /* ê²°ê³¼ íŒ¨ë„ HUD */
  .hud-rings { display: flex; justify-content: space-around; align-items: flex-end; padding: 10px 0 20px; }
  .ring-container { position: relative; width: 90px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
  .ring-svg { width: 70px; height: 70px; transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 8; }
  .ring-val { fill: none; stroke: var(--accent); stroke-width: 8; stroke-linecap: round; transition: stroke-dasharray 1s ease; }
  .ring-text { position: absolute; top: 26px; left: 50%; transform: translateX(-50%); font-family: var(--font-tech); font-size: 15px; font-weight: 700; color: var(--text-main); }
  .ring-label { font-size: 11px; color: var(--text-sub); }

  .stat-summary { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; }
  .sum-item { text-align: center; flex: 1; }
  .sum-label { font-size: 11px; color: var(--text-sub); display: block; margin-bottom: 4px;}
  .sum-val { font-size: 16px; font-weight: 700; color: var(--accent); font-family: var(--font-tech); }

  .rank8-card {
    background: rgba(53, 199, 89, 0.1); border: 1px solid var(--ok);
    border-radius: 12px; padding: 16px; display: flex;
    justify-content: space-between; align-items: center; margin-bottom: 10px;
  }
  .rank8-label { color: var(--ok); font-weight: 700; font-size: 15px; display: flex; align-items: center; gap: 6px; }
  .rank8-label::before { content:'â˜…'; }
  .rank8-value { font-family: var(--font-tech); color: #fff; font-size: 18px; font-weight: 700; }
  .rank8-sub { font-size: 12px; color: rgba(255,255,255,0.5); margin-left: 8px; }

  .toggle-details-btn {
    width: 100%; background: rgba(255,255,255,0.05); border: none;
    color: var(--text-sub); padding: 12px; border-radius: 8px;
    font-size: 13px; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 5px;
  }
  
  .hidden-details { display: none; margin-top: 10px; animation: slideDown 0.3s ease; }
  .hidden-details.open { display: block; }
  @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

  .detail-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .detail-table th { text-align: left; color: var(--text-sub); padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); }
  .detail-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .rank-badge { padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 700; background: rgba(255,255,255,0.1); }
  .rank-badge.s { color: var(--ok); background: rgba(53, 199, 89, 0.15); border: 1px solid var(--ok); }
  .rank-badge.a { color: var(--warn); background: rgba(255, 179, 0, 0.15); border: 1px solid var(--warn); }

  /* --- ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ (ì›ë³¸.htmlê³¼ ì¼ì¹˜ì‹œí‚´) --- */
  @media (max-width: 900px) {
    body { height: auto; overflow: auto; background: #1a1d26; }
    .app-container { flex-direction: column; height: auto; min-height: 100vh; }
    
    .sidebar {
      position: fixed; top: 0; left: 0; width: 85%; max-width: 320px;
      height: 100vh; transform: translateX(-100%);
      box-shadow: 2px 0 20px rgba(0,0,0,0.5); border-right: 1px solid rgba(255,255,255,0.1);
    }
    .sidebar.active { transform: translateX(0); }
    .sidebar-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); z-index: 90;
      display: none; opacity: 0; transition: opacity 0.3s;
    }
    .sidebar-overlay.active { display: block; opacity: 1; }
    
    .main-content { overflow: visible; height: auto; }
    .menu-toggle { display: block; }
    
    .dashboard { grid-template-columns: 1fr; padding: 60px 15px 15px; gap: 15px; }
    
    .panel { padding: 20px; backdrop-filter: none; min-height: auto; }
    .notice-panel { padding: 15px 20px; }
    
    /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ëª¨ë°”ì¼ ìµœì í™” */
    .top-nav { 
      position: fixed; justify-content: space-between; 
      padding: 10px 15px; background: rgba(15,17,21,0.95); 
      pointer-events: auto; width: 100%;
    }
    .nav-controls { background: transparent; border: none; padding: 0; }
    .menu-title-mobile { display: block; font-weight: 700; color: var(--accent); font-family: var(--font-tech); font-size: 16px; }
  }
  
  @media (min-width: 901px) {
      .menu-title-mobile { display: none; }
  }

  #toastWrap { position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; flex-direction: column; gap: 8px; width: 90%; pointer-events: none; }
  .toast { background: rgba(30, 35, 45, 0.95); color: var(--text-main); padding: 12px 20px; border-radius: 12px; text-align: center; border: 1px solid var(--accent); opacity: 0; transition: 0.3s; }
</style>
</head>
<body>

<div class="floating-tip" id="floatingTip"></div>
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<div class="app-container">
  <!-- 1. ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="brand-row">
        <div class="brand">ê¼¬ë¹„ì•„ë¹  ë†€ì´í„°</div>
        <div class="menu-toggle" id="closeSidebarBtn" style="font-size:20px; display:none;">âœ•</div>
      </div>
      <div class="ver"><span>Date : 2026.02.20</span><span>Data by. ê¼¬ë¹„ì•„ë¹ </span></div>
    </div>
    <div class="search-area"><div class="search-box"><input type="text" id="petSearch" placeholder="í˜íŠ¸ ì´ë¦„ ê²€ìƒ‰..." autocomplete="off" /></div></div>
    <div class="filter-chips" id="chosungTokens" style="padding-bottom:5px; min-height:30px;"></div>
    <div class="filter-chips" id="chosung"></div>
    <div style="padding: 0 20px 10px; display:flex; gap:10px; align-items:center;">
       <span style="font-size:11px; color:var(--text-sub);">ì¦ê²¨ì°¾ê¸°:</span>
       <div id="favChips" style="display:flex; gap:5px; flex-wrap:wrap;"></div>
    </div>
    <div class="pet-list" id="petList"></div>
  </aside>

  <!-- 2. ë©”ì¸ ì»¨í…ì¸  -->
  <main class="main-content">
    <nav class="top-nav">
      <div class="menu-title-mobile">ê¼¬ë¹„ì•„ë¹  ë†€ì´í„°</div>
      <div class="nav-controls">
          <div class="menu-toggle" id="openSidebarBtn" style="margin-right: 10px;">â˜°</div>
          <button class="admin-btn" id="btnAdmin" title="Admin">â˜…</button>
      </div>
    </nav>

    <div class="dashboard">
      <section class="panel notice-panel">
        <div class="notice-header"><div class="notice-title">SYSTEM NOTICE (StoneAge Together)</div></div>
        <div class="notice-content">
          - ì…ë ¥ëœ í˜íŠ¸ ëŠ¥ë ¥ì¹˜ì—ëŠ” ì˜¤íƒ€ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ í˜íŠ¸ ì¡°íšŒ ì‹œ ê²Œì„ ë‚´ í˜íŠ¸ì˜ ì´ˆê¸°ì¹˜ ë° ì„±ì¥ë¥ ì´ ê°™ì€ì§€ í™•ì¸í•˜ì„¸ìš”.<br>
          - ì˜¤íƒ€ê°€ ìˆë‹¤ë©´ ë§ì”€ ë¶€íƒë“œë¦¬ë©°, í•´ë‹¹ ê³„ì‚°ê¸°ëŠ” ì¬ë¯¸ë¡œë§Œ ë´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤. <br>
          <span style="color:var(--accent)">- íŠ¹ì´ì‚¬í•­ : ê¼¬ë¹„ / ë‚¨ì•„ / í‘¸ë“¤(ê°ˆìƒ‰) / 20.03.24 ì¶œìƒ / ì¤‘ì„±í™” O</span>
        </div>
      </section>

      <!-- ì…ë ¥ íŒ¨ë„ -->
      <section class="panel">
        <h2><span id="selectedPetTitle">í˜íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span></h2>
        <div class="input-group-title">Sê¸‰ ê¸°ì¤€ (ì´ˆê¸°ì¹˜ / ì„±ì¥ë¥ )</div>
        <div class="stat-grid">
          <div class="stat-col"><label>ë‚´êµ¬ë ¥</label><div class="stat-box readonly"><input type="text" id="s0_hp" readonly placeholder="-"></div><div class="stat-box readonly" style="margin-top:6px"><input type="text" id="sg_hp" readonly placeholder="-"></div></div>
          <div class="stat-col"><label>ê³µê²©ë ¥</label><div class="stat-box readonly"><input type="text" id="s0_atk" readonly placeholder="-"></div><div class="stat-box readonly" style="margin-top:6px"><input type="text" id="sg_atk" readonly placeholder="-"></div></div>
          <div class="stat-col"><label>ë°©ì–´ë ¥</label><div class="stat-box readonly"><input type="text" id="s0_def" readonly placeholder="-"></div><div class="stat-box readonly" style="margin-top:6px"><input type="text" id="sg_def" readonly placeholder="-"></div></div>
          <div class="stat-col"><label>ìˆœë°œë ¥</label><div class="stat-box readonly"><input type="text" id="s0_agi" readonly placeholder="-"></div><div class="stat-box readonly" style="margin-top:6px"><input type="text" id="sg_agi" readonly placeholder="-"></div></div>
        </div>
        <div class="input-group-title" style="margin-top:20px; color:var(--accent);">Lv.1 í˜íŠ¸ ëŠ¥ë ¥ì¹˜ ì…ë ¥</div>
        <div class="stat-grid">
          <div class="stat-col"><label>ë‚´êµ¬ë ¥</label><div class="stat-box"><input type="number" id="obs_hp" placeholder="0"></div><div class="stepper-btn"><button class="s-btn" data-target="obs_hp" data-delta="-1">-1</button><button class="s-btn" data-target="obs_hp" data-delta="1">+1</button></div></div>
          <div class="stat-col"><label>ê³µê²©ë ¥</label><div class="stat-box"><input type="number" id="obs_atk" placeholder="0"></div><div class="stepper-btn"><button class="s-btn" data-target="obs_atk" data-delta="-1">-1</button><button class="s-btn" data-target="obs_atk" data-delta="1">+1</button></div></div>
          <div class="stat-col"><label>ë°©ì–´ë ¥</label><div class="stat-box"><input type="number" id="obs_def" placeholder="0"></div><div class="stepper-btn"><button class="s-btn" data-target="obs_def" data-delta="-1">-1</button><button class="s-btn" data-target="obs_def" data-delta="1">+1</button></div></div>
          <div class="stat-col"><label>ìˆœë°œë ¥</label><div class="stat-box"><input type="number" id="obs_agi" placeholder="0"></div><div class="stepper-btn"><button class="s-btn" data-target="obs_agi" data-delta="-1">-1</button><button class="s-btn" data-target="obs_agi" data-delta="1">+1</button></div></div>
        </div>
        <div class="action-btns"><button class="btn-main btn-reset" id="btnReset">ë¦¬ì…‹</button><button class="btn-main btn-calc" id="btnCalc">ë¶„ì„ ì‹œì‘</button></div>
      </section>

      <!-- ê²°ê³¼ íŒ¨ë„ (HUD ìŠ¤íƒ€ì¼) -->
      <section class="panel result-panel">
        <h2>ANALYSIS HUD</h2>
        <div class="hud-rings">
          <div class="ring-container">
            <svg class="ring-svg" viewBox="0 0 36 36"><path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /><path id="ringSuccess" class="ring-val" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /></svg>
            <div class="ring-text" id="kpiSuccess">0%</div><span class="ring-label">8ë“±ê¸‰ í™•ë¥ </span>
          </div>
          <div class="ring-container">
            <svg class="ring-svg" viewBox="0 0 36 36"><path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /><path id="ringTries" class="ring-val" style="stroke:#ffb300" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /></svg>
            <div class="ring-text" id="kpiTries">-</div><span class="ring-label">ì‹œë„ íšŸìˆ˜</span>
          </div>
        </div>
        <div class="stat-summary">
          <div class="sum-item"><span class="sum-label">ì¶œí˜„ í™•ë¥ </span><span class="sum-val" id="kpiAppear">-</span></div>
          <div class="sum-item"><span class="sum-label">ì´ ê²½ìš°ì˜ ìˆ˜</span><span class="sum-val" id="totMatches">-</span></div>
          <div class="sum-item"><span class="sum-label">8ë“±ê¸‰ ë§¤ì¹­</span><span class="sum-val" id="rank8Matches">-</span></div>
        </div>
        <div style="margin-top:20px; flex:1; display:flex; flex-direction:column;">
          <div class="input-group-title">ë“±ê¸‰ ë¶„í¬</div>
          <div id="dist"><div style="text-align:center; color:var(--text-sub); padding:20px;">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div></div>
        </div>
      </section>

      <!-- [í†µí•© ê¸°ëŠ¥] í˜íŠ¸ì¡ì´ ë¡œê·¸ ì•Œë¦¬ë¯¸ -->
      <section class="panel log-panel">
        <div class="log-header-row">
            <h2>LOG MONITORING</h2>
            <div class="log-controls">
                <div class="status-indicator"><div id="statusDot" class="dot"></div> <span id="dirStatus">í´ë” ì„ íƒ ëŒ€ê¸°...</span></div>
                <button class="btn-dir-picker" id="btnPicker">ğŸ“‚ Chat í´ë” ì„ íƒ</button>
                <button id="btnSoundTest" style="padding:8px 12px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:var(--text-sub); border-radius:6px; cursor:pointer; font-size:12px;">ğŸ”Š í…ŒìŠ¤íŠ¸</button>
            </div>
        </div>
        <div class="log-container" id="logDisplay">
            <div style="color:var(--text-sub); text-align:center; padding-top:60px;">ë¡œê·¸ ê°ì‹œë¥¼ ì‹œì‘í•˜ë ¤ë©´ ê²Œì„ í´ë” ë‚´ 'Chat' í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
        </div>
      </section>
    </div>
  </main>
</div>

<div id="toastWrap"></div>

<script>
/* ========= ë°ì´í„° ë¡œë”© & ìœ í‹¸ ========= */
const GH_OWNER  = "kkoby-daddy";
const GH_REPO   = "kkoby_together"; 
const GH_BRANCH = "main";
const PETS_PATH = "data/pets.json";
const REMOTE_PETS = `https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/${GH_BRANCH}/${PETS_PATH}`;
const LOCAL_PETS = "data/pets.json";
const R8_JSON_CANDIDATES = [
  "data/guaranteed_rank8.full.json",
  "data/guaranteed_rank8.min.json",
  "guaranteed_rank8.sample8.json"
];
const LS_TABLE = "TogetherPetTable_cache";
const TOTAL = 178750;
const FAV_LS_KEY = "pet_favs_v1";
const ALERT_SOUND_URL = `https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/${GH_BRANCH}/sam_02.wav`;
const alertAudio = new Audio(ALERT_SOUND_URL);
const decoder = new TextDecoder('euc-kr'); 
const BAG_FULL_REGEX = /ê°€ë°©\s*:\s*\[\s*0\s*\/\s*5\s*\]/;
const CAPTURE_REGEX = /í¬íší•˜ì˜€ìŠµë‹ˆë‹¤|íšë“í•˜ì˜€ìŠµë‹ˆë‹¤|ë‚˜íƒ€ë‚¬ë‹¤|ì£¼ì› ìŠµë‹ˆë‹¤/;

let GLOBAL_TABLE = {}, ALL_NAMES = [], R8MAP = {}, FAVS = [];
let dirHandle = null, lastLogText = "", lastChatFile = "";
let selectedName = null, currentChosung = "";

function getJSONLS(key, fallback={}){ try{ return JSON.parse(localStorage.getItem(key)||JSON.stringify(fallback)); }catch{ return fallback; } }
function setJSONLS(key, obj){ localStorage.setItem(key, JSON.stringify(obj)); }
function fetchJSON(url){ return fetch(url+`?v=${Date.now()}`,{cache:"no-store"}).then(r=>{ if(!r.ok) throw 0; return r.json();}); }
function showToast(msg){
  const wrap = document.getElementById("toastWrap");
  const t = document.createElement("div"); t.className = "toast"; t.textContent = msg;
  wrap.appendChild(t); void t.offsetWidth; t.style.opacity = '1';
  setTimeout(()=>{ t.style.opacity = '0'; setTimeout(()=>t.remove(), 300); }, 2000);
}

/* íˆ´íŒ ë¡œì§ */
const tipEl = document.getElementById('floatingTip');
function hideTip(){ tipEl.classList.remove('show'); }
function showTip(target){
  const text = target.getAttribute('data-tip');
  if(!text){ hideTip(); return; }
  const lines = String(text).split('\n');
  tipEl.textContent = '';
  lines.forEach((line,i)=>{
    tipEl.appendChild(document.createTextNode(line));
    if(i < lines.length-1) tipEl.appendChild(document.createElement('br'));
  });
  tipEl.classList.add('show');
  const rect = target.getBoundingClientRect();
  let left = rect.left + rect.width/2 - tipEl.offsetWidth/2;
  left = Math.max(10, Math.min(left, window.innerWidth - tipEl.offsetWidth - 10));
  let top = rect.top - tipEl.offsetHeight - 10;
  if(top < 10) top = rect.bottom + 10;
  tipEl.style.left = `${left}px`; tipEl.style.top  = `${top}px`;
}
document.addEventListener('mouseover', (e)=>{ const t = e.target.closest('.tip'); if(t) showTip(t); }, true);
document.addEventListener('mouseout', (e)=>{ const t = e.target.closest('.tip'); if(t) hideTip(); }, true);
window.addEventListener('scroll', hideTip, true);

/* ========= ë°ì´í„° ë¡œë”© ========= */
async function loadGlobalTable(){
  try{
    const obj = await fetchJSON(REMOTE_PETS);
    if(typeof obj!=="object" || Array.isArray(obj)) throw 0;
    GLOBAL_TABLE = obj; setJSONLS(LS_TABLE, obj);
  }catch{
    try{
      const obj = await fetchJSON(LOCAL_PETS);
      GLOBAL_TABLE = obj; setJSONLS(LS_TABLE, obj);
    }catch{
      GLOBAL_TABLE = getJSONLS(LS_TABLE, {});
    }
  }
  ALL_NAMES = Object.keys(GLOBAL_TABLE).sort((a,b)=>a.localeCompare(b,'ko'));
  FAVS = loadFavs().filter(n => GLOBAL_TABLE[n]);
  saveFavs(); renderFavChips(); renderPetList();
}

async function loadRank8Map(){
  for(const path of R8_JSON_CANDIDATES){
    try{
      const m = await fetchJSON(`https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/${GH_BRANCH}/${path}`);
      if (typeof m==="object" && !Array.isArray(m)){ 
        R8MAP = m; 
        renderPetList();
        return; 
      }
    }catch{}
  }
}

/* ========= ë¡œê·¸ ì•Œë¦¬ë¯¸ ê¸°ëŠ¥ ========= */
document.getElementById('btnSoundTest').onclick = () => {
    alertAudio.currentTime = 0;
    alertAudio.play().then(() => showToast("ì•Œë¦¼ìŒ í…ŒìŠ¤íŠ¸ ì„±ê³µ")).catch(() => showToast("ì‚¬ìš´ë“œ ì¬ìƒì´ ì°¨ë‹¨ë¨"));
};

document.getElementById('btnPicker').onclick = async () => {
  try {
    dirHandle = await window.showDirectoryPicker();
    document.getElementById('dirStatus').textContent = `ê°ì‹œ ì¤‘: ${dirHandle.name}`;
    document.getElementById('statusDot').classList.add('active');
    document.getElementById('logDisplay').innerHTML = `<div style="color:var(--ok); text-align:center; padding-top:60px;">ì—°ê²°ë¨. ê²Œì„ ë¡œê·¸ ëŒ€ê¸° ì¤‘...</div>`;
    alertAudio.load(); startMonitoring(); showToast("ë¡œê·¸ ê°ì‹œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.");
  } catch (e) { showToast("í´ë” ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."); }
};

async function startMonitoring() {
  setInterval(async () => {
    if(!dirHandle) return;
    try {
      let latestEntry = null; let latestTime = 0;
      for await (const entry of dirHandle.values()) {
        if (entry.kind === 'file' && entry.name.toUpperCase().startsWith('CHAT_')) {
          const file = await entry.getFile();
          if (file.lastModified > latestTime) { latestTime = file.lastModified; latestEntry = entry; }
        }
      }
      if (latestEntry) {
        const file = await latestEntry.getFile();
        const buffer = await file.arrayBuffer();
        const text = decoder.decode(buffer);
        if (latestEntry.name !== lastChatFile) {
          lastChatFile = latestEntry.name;
          processLogs(text.trim().split('\n').slice(-10).join('\n'), true); 
          lastLogText = text;
        } else if (text.length > lastLogText.length) {
          const newPart = text.substring(lastLogText.length);
          lastLogText = text;
          processLogs(newPart, false);
        }
      }
    } catch (err) { console.error(err); }
  }, 2000);
}

function processLogs(newText, isInitial) {
  const lines = newText.split('\n').filter(l => l.trim().length > 0);
  lines.forEach(line => {
    const isFullBag = BAG_FULL_REGEX.test(line);
    const isCapture = CAPTURE_REGEX.test(line);
    if (isFullBag && !isInitial) { alertAudio.currentTime = 0; alertAudio.play().catch(() => {}); }
    addLogUI(line, isFullBag, isCapture);
  });
}

function addLogUI(msg, isBad, isGood) {
  const container = document.getElementById('logDisplay');
  if (container.innerText.includes("ì‹œì‘í•˜ë ¤ë©´") || container.innerText.includes("ì—°ê²°ë¨")) container.innerHTML = "";
  const div = document.createElement('div'); div.className = 'log-entry';
  const timeMatch = msg.match(/\[(\d{2}:\d{2}:\d{2})\]/);
  const timeStr = timeMatch ? timeMatch[1] : new Date().toLocaleTimeString('ko-KR', {hour12:false});
  const cleanMsg = msg.replace(/\[\d{2}:\d{2}:\d{2}\]/, "").trim();
  let msgClass = "log-msg";
  if (isBad) msgClass += " highlight"; else if (isGood) msgClass += " capture";
  div.innerHTML = `<span class="log-time">[${timeStr}]</span><span class="${msgClass}">${cleanMsg}</span>`;
  container.appendChild(div);
  if (container.children.length > 20) container.removeChild(container.firstElementChild);
  container.scrollTop = container.scrollHeight;
}

/* ========= ì´ˆì„± í•„í„° ë¡œì§ ========= */
const CHO_CODE = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
const CHO_SIMPLE = (c)=>({"ã„²":"ã„±","ã„¸":"ã„·","ã…ƒ":"ã…‚","ã…†":"ã……","ã…‰":"ã…ˆ"}[c]||c);
function getChosung(str){
  let out="";
  for(const ch of str){
    const code = ch.charCodeAt(0);
    if(code<0xAC00 || code>0xD7A3){ out+=ch; continue; }
    const idx = Math.floor((code - 0xAC00) / 588);
    out += CHO_SIMPLE(CHO_CODE[idx]);
  }
  return out;
}

const CHO_BUTTONS = ['ã„±','ã„´','ã„·','ã„¹','ã…','ã…‚','ã……','ã…‡','ã…ˆ','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
const chosungContainer = document.getElementById('chosung');
const chosungTokens = document.getElementById('chosungTokens');

function renderChosungTokens(){
  chosungTokens.innerHTML = "";
  const label = document.createElement('div'); label.className = 'chip label'; label.textContent = "ì„ íƒí•œ ì´ˆì„± :";
  chosungTokens.appendChild(label);
  if(!currentChosung) return;
  for(const ch of currentChosung){
    const t = document.createElement('div'); t.className = 'chip active'; t.textContent = ch;
    chosungTokens.appendChild(t);
  }
  const clearBtn = document.createElement('div'); clearBtn.className = 'chip'; clearBtn.textContent = 'â†º';
  clearBtn.onclick = () => { currentChosung = ""; renderPetList(); renderChosungTokens(); Array.from(chosungContainer.children).forEach(el=>el.classList.remove('active')); };
  chosungTokens.appendChild(clearBtn);
}

CHO_BUTTONS.forEach(c => {
  const chip = document.createElement('div'); chip.className = 'chip'; chip.textContent = c;
  chip.addEventListener('click', () => {
    currentChosung += c; renderPetList(); renderChosungTokens();
    Array.from(chosungContainer.children).forEach(el=>el.classList.remove('active')); chip.classList.add('active');
  });
  chosungContainer.appendChild(chip);
});

/* ========= ì¦ê²¨ì°¾ê¸° ë¡œì§ ========= */
function loadFavs(){ try{ const arr = JSON.parse(localStorage.getItem(FAV_LS_KEY)||"[]"); return Array.isArray(arr) ? arr.slice(0,5) : []; }catch{ return []; } }
function saveFavs(){ localStorage.setItem(FAV_LS_KEY, JSON.stringify(FAVS)); }
function isFav(name){ return FAVS.includes(name); }
function toggleFav(n){ if(isFav(n)) FAVS = FAVS.filter(x=>x!==n); else { if(FAVS.length>=5){ showToast("ìµœëŒ€ 5ê°œê¹Œì§€ ê°€ëŠ¥"); return; } FAVS.push(n); } saveFavs(); renderFavChips(); renderPetList(); }
function renderFavChips(){
  const box = document.getElementById('favChips'); box.innerHTML = "";
  FAVS.forEach(n => {
    const c = document.createElement('div'); c.className = 'chip active'; c.textContent = n;
    c.addEventListener('click', () => { selectPetName(n); closeSidebar(); }); box.appendChild(c);
  });
}

/* ========= í˜íŠ¸ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ ========= */
function renderPetList(){
  const kw = document.getElementById('petSearch').value.trim();
  const listEl = document.getElementById('petList');
  if(!listEl) return;
  listEl.innerHTML = "";
  const filtered = ALL_NAMES.filter(n => {
    const matchKw = kw ? n.includes(kw) : true;
    const matchCho = currentChosung ? getChosung(n).startsWith(currentChosung) : true;
    return matchKw && matchCho;
  });
  filtered.forEach(n => {
    const item = document.createElement('div'); item.className = 'pet-item';
    if(selectedName === n) item.classList.add('selected');
    const nameSpan = document.createElement('span'); nameSpan.className = 'pet-name'; nameSpan.textContent = n;
    item.appendChild(nameSpan);
    const rightDiv = document.createElement('div'); rightDiv.className = 'pet-right';
    const r8 = R8MAP[n];
    if (r8) {
        const sets = Array.isArray(r8.obs_100_rank8) ? r8.obs_100_rank8 : (Array.isArray(r8) ? r8 : null);
        if (sets && sets.length > 0) {
            const badge = document.createElement('span'); badge.className = 'badge-r8 tip'; badge.textContent = '100%';
            badge.setAttribute('data-tip', `8ë“±ê¸‰ ë³´ì¥ ì´ˆê¸°ì¹˜\n${sets.slice(0,10).map(a=>`(${a[0]},${a[1]},${a[2]},${a[3]})`).join(' Â· ')}`);
            badge.addEventListener('click', (e) => { e.stopPropagation(); });
            rightDiv.appendChild(badge);
        }
    }
    const star = document.createElement('span'); star.className = 'fav-icon ' + (isFav(n)?'active':''); star.textContent = 'â˜…';
    star.onclick = (e) => { e.stopPropagation(); toggleFav(n); };
    rightDiv.appendChild(star);
    item.appendChild(rightDiv);
    item.onclick = () => { selectPetName(n); closeSidebar(); };
    listEl.appendChild(item);
  });
}
document.getElementById('petSearch').addEventListener('input', renderPetList);

/* ========= ê³„ì‚° ë° ê²°ê³¼ ì¶œë ¥ ========= */
function selectPetName(n){
  selectedName=n; renderPetList();
  const row=GLOBAL_TABLE[n]||null;
  document.getElementById('selectedPetTitle').textContent = n;
  if(row?.s0){
    document.getElementById('s0_hp').value = Number(row.s0.hp).toFixed(2);
    document.getElementById('s0_atk').value = Number(row.s0.atk).toFixed(2);
    document.getElementById('s0_def').value = Number(row.s0.def).toFixed(2);
    document.getElementById('s0_agi').value = Number(row.s0.agi).toFixed(2);
    document.getElementById('obs_hp').value = Math.floor(row.s0.hp); 
    document.getElementById('obs_atk').value = Math.floor(row.s0.atk);
    document.getElementById('obs_def').value = Math.floor(row.s0.def); 
    document.getElementById('obs_agi').value = Math.floor(row.s0.agi);
  }
  if(row?.sg){
    document.getElementById('sg_hp').value = Number(row.sg.hp).toFixed(2);
    document.getElementById('sg_atk').value = Number(row.sg.atk).toFixed(2);
    document.getElementById('sg_def').value = Number(row.sg.def).toFixed(2);
    document.getElementById('sg_agi').value = Number(row.sg.agi).toFixed(2);
  }
  resetResult();
}

document.getElementById('btnCalc').onclick = () => {
  if(!selectedName) return showToast("í˜íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”");
  const obs = ['hp','atk','def','agi'].map(k => parseInt(document.getElementById('obs_'+k).value || 0));
  const row = GLOBAL_TABLE[selectedName];
  const res = calculate_logic({k:row.k, u:row.u}, obs);
  renderResult(res);
};

function calculate_logic(pku, obs){
  Decimal.set({ precision:20, rounding: Decimal.ROUND_HALF_UP });
  const k = new Decimal(pku.k), fac = k.dividedBy(100), u = pku.u;
  let matches = 0, rank8 = 0, dist = {};
  for(let ar=-2; ar<=2; ar++) for(let dr=-2; dr<=2; dr++) for(let gr=-2; gr<=2; gr++) for(let hr=-2; hr<=2; hr++){
    for(let ab=0; ab<=10; ab++) for(let db=0; db<=10; db++) for(let gb=0; gb<=10; gb++){
      const hb = 10-ab-db-gb; if(hb<0 || hb>10) continue;
      const iH = new Decimal(u.hp+hr+hb).times(fac), iA = new Decimal(u.atk+ar+ab).times(fac);
      const iD = new Decimal(u.def+dr+db).times(fac), iG = new Decimal(u.agi+gr+gb).times(fac);
      if(iG.floor().toNumber() !== obs[3]) continue;
      if(iH.times(4).plus(iA).plus(iD).plus(iG).floor().toNumber() !== obs[0]) continue;
      if(iH.times(0.1).plus(iA).plus(iD.times(0.1)).plus(iG.times(0.05)).floor().toNumber() !== obs[1]) continue;
      if(iH.times(0.1).plus(iA.times(0.1)).plus(iD).plus(iG.times(0.05)).floor().toNumber() !== obs[2]) continue;
      matches++; const r = ar+dr+gr+hr; dist[r]=(dist[r]||0)+1; if(r===8) rank8++;
    }
  }
  return {matches, rank8, dist};
}

function renderResult(res) {
  const matches = res.matches|0;
  const rank8 = res.rank8|0;
  const successPct = matches ? (rank8/matches*100) : 0;
  const appear = matches/TOTAL*100;
  const tries = successPct > 0 ? (100/successPct) : Infinity;
  document.getElementById('ringSuccess').style.strokeDasharray = `${Math.min(successPct, 100).toFixed(1)}, 100`;
  const tryGauge = Math.min((tries / 200) * 100, 100);
  document.getElementById('ringTries').style.strokeDasharray = `${tryGauge.toFixed(1)}, 100`;
  const tryColor = tries <= 5 ? 'var(--ok)' : (tries <= 20 ? 'var(--warn)' : 'var(--bad)');
  document.getElementById('ringTries').style.stroke = tryColor;
  document.getElementById('kpiSuccess').textContent = successPct.toFixed(2) + "%";
  document.getElementById('kpiTries').textContent = Number.isFinite(tries) ? Math.round(tries).toLocaleString() : "-";
  document.getElementById('kpiAppear').textContent = appear.toFixed(4) + "%";
  document.getElementById('totMatches').textContent = matches.toLocaleString();
  document.getElementById('rank8Matches').textContent = rank8.toLocaleString();
  const entries = Object.entries(res.dist).map(([r,c]) => ({r:parseInt(r), c})).sort((a,b) => b.r - a.r);
  if(entries.length === 0) { document.getElementById('dist').innerHTML = `<div style="text-align:center; padding:20px; color:var(--text-sub);">ì¼ì¹˜í•˜ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`; return; }
  let html = "";
  const grade8 = entries.find(e => e.r === 8);
  const count8 = grade8 ? grade8.c : 0;
  const pct8 = matches ? (count8/matches*100).toFixed(2) : "0.00";
  html += `<div class="rank8-card"><div class="rank8-label">8ë“±ê¸‰ <span class="rank8-sub">(MAX)</span></div><div class="rank8-value">${count8.toLocaleString()}ê°œ <span style="font-size:14px; opacity:0.7">(${pct8}%)</span></div></div>`;
  const otherGrades = entries.filter(e => e.r !== 8);
  if(otherGrades.length > 0) {
    html += `<button class="toggle-details-btn" onclick="toggleDetails(this)">â–¼ ë‚˜ë¨¸ì§€ ë“±ê¸‰ ë³´ê¸° (${otherGrades.length}ì¢…)</button>`;
    html += `<div class="hidden-details" id="hiddenDetails"><table class="detail-table" style="margin-top:10px;"><thead><tr><th>ë“±ê¸‰</th><th>ê°œìˆ˜</th><th>í™•ë¥ </th></tr></thead><tbody>`;
    otherGrades.forEach(e => {
      const pct = (e.c/matches*100).toFixed(2);
      let badgeClass = "rank-badge"; if(e.r >= 5) badgeClass += " a"; else badgeClass += " s"; 
      html += `<tr><td><span class="${badgeClass}">${e.r}ë“±ê¸‰</span></td><td>${e.c.toLocaleString()}</td><td>${pct}%</td></tr>`;
    });
    html += `</tbody></table></div>`;
  }
  document.getElementById('dist').innerHTML = html;
}

function toggleDetails(btn) {
  const details = document.getElementById('hiddenDetails');
  const isOpen = details.classList.contains('open');
  if(isOpen) { details.classList.remove('open'); btn.innerHTML = `â–¼ ë‚˜ë¨¸ì§€ ë“±ê¸‰ ë³´ê¸°`; btn.style.background = "rgba(255,255,255,0.05)"; } 
  else { details.classList.add('open'); btn.innerHTML = `â–² ì ‘ê¸°`; btn.style.background = "rgba(255,255,255,0.15)"; }
}

function resetResult() {
    document.getElementById('kpiSuccess').textContent = "0%"; document.getElementById('kpiTries').textContent = "-";
    document.getElementById('ringSuccess').style.strokeDasharray = "0, 100"; document.getElementById('ringTries').style.strokeDasharray = "0, 100";
    document.getElementById('kpiAppear').textContent = "-"; document.getElementById('totMatches').textContent = "-"; document.getElementById('rank8Matches').textContent = "-";
    document.getElementById('dist').innerHTML = '<div style="text-align:center; color:var(--text-sub); padding:20px;">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>';
}

/* ========= UI ì œì–´ (ì‚¬ì´ë“œë°” ë“±) ========= */
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('sidebarOverlay');
function openSidebar() { sidebar.classList.add('active'); overlay.classList.add('active'); document.body.style.overflow = 'hidden'; }
function closeSidebar() { sidebar.classList.remove('active'); overlay.classList.remove('active'); document.body.style.overflow = 'auto'; }
document.getElementById('openSidebarBtn').onclick = openSidebar;
document.getElementById('closeSidebarBtn').onclick = closeSidebar;
overlay.onclick = closeSidebar;
document.getElementById('btnReset').onclick = () => location.reload();

document.addEventListener('click', (e) => {
    const btn = e.target.closest('.s-btn'); if(!btn) return;
    const input = document.getElementById(btn.dataset.target);
    input.value = parseInt(input.value||0) + parseInt(btn.dataset.delta);
});

function enableWheelStep(el){
  el.addEventListener('wheel',(e)=>{ if(document.activeElement!==el) return; e.preventDefault(); const delta = e.deltaY<0? 1 : -1; el.value = String(parseInt(el.value||"0",10) + delta); }, {passive:false});
}

(async function init(){
    renderChosungTokens();
    renderPetList();
    ['obs_hp','obs_atk','obs_def','obs_agi'].forEach(id => { const el = document.getElementById(id); if(el) enableWheelStep(el); });
    document.getElementById('btnAdmin').onclick = ()=>location.href="./admin.html";
    await loadGlobalTable(); 
    await loadRank8Map(); 
})();
</script>
</body>
</html>
